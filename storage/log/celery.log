[2025-07-10 22:47:32,245: INFO/MainProcess] Task internal.task.document_task.update_document_enabled[9543e763-20e4-4140-8882-f27d8df3f59a] received
[2025-07-10 22:47:32,268: INFO/MainProcess] HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
[2025-07-10 22:47:32,275: INFO/MainProcess] HTTP Request: GET http://localhost:8080/v1/schema/Dataset "HTTP/1.1 200 OK"
[2025-07-10 22:47:32,278: INFO/MainProcess] HTTP Request: GET http://localhost:8080/v1/schema/Dataset "HTTP/1.1 200 OK"
[2025-07-10 22:47:32,281: INFO/MainProcess] BEGIN (implicit)
[2025-07-10 22:47:32,282: INFO/MainProcess] SELECT document.id AS document_id, document.account_id AS document_account_id, document.dataset_id AS document_dataset_id, document.upload_file_id AS document_upload_file_id, document.process_rule_id AS document_process_rule_id, document.batch AS document_batch, document.name AS document_name, document.position AS document_position, document.character_count AS document_character_count, document.token_count AS document_token_count, document.processing_started_at AS document_processing_started_at, document.parsing_completed_at AS document_parsing_completed_at, document.splitting_completed_at AS document_splitting_completed_at, document.indexing_completed_at AS document_indexing_completed_at, document.completed_at AS document_completed_at, document.stopped_at AS document_stopped_at, document.error AS document_error, document.enabled AS document_enabled, document.disabled_at AS document_disabled_at, document.status AS document_status, document.updated_at AS document_updated_at, document.created_at AS document_created_at 
FROM document 
WHERE document.id = %(pk_1)s::UUID
[2025-07-10 22:47:32,282: INFO/MainProcess] [cached since 168.3s ago] {'pk_1': UUID('49d0d18b-db08-436f-b31f-4371a638d2d7')}
[2025-07-10 22:47:32,286: WARNING/MainProcess] /Users/icourt1/.pyenv/versions/3.10.16/envs/llmops-env/lib/python3.10/site-packages/sqlalchemy/orm/context.py:2788: ResourceWarning: unclosed <socket.socket fd=19, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('::1', 56812, 0, 0), raddr=('::1', 8080, 0, 0)>
  _instance = loading._instance_processor(

[2025-07-10 22:47:32,287: INFO/MainProcess] SELECT segment.id AS segment_id, segment.node_id AS segment_node_id, segment.enabled AS segment_enabled 
FROM segment 
WHERE segment.document_id = %(document_id_1)s::UUID AND segment.status = %(status_1)s
[2025-07-10 22:47:32,287: INFO/MainProcess] [cached since 168.3s ago] {'document_id_1': UUID('49d0d18b-db08-436f-b31f-4371a638d2d7'), 'status_1': <SegmentStatus.COMPLETED: 'completed'>}
[2025-07-10 22:47:32,292: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/7b30a8c4-adf1-4325-a7c8-0fefe89fe60a "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,295: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/9a1646d4-478e-41e7-b93e-95b8963989dd "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,297: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/7cf8ed58-36df-4932-a4c6-2e968076c160 "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,299: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/a7404b87-eb57-496f-a6a4-a76834487421 "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,300: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/ba5a56a2-cb6b-477e-9203-251779416f05 "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,303: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/d0c0db2a-c0c7-4fe7-b8f1-2a650314fd7a "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,305: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/2f33f2b9-4f95-4508-8e7d-09e7646bdf84 "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,307: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/ce8ddf79-2c11-4180-83c7-ab39014d176f "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,308: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/43bc318c-1dd5-45c9-88a9-373f37f39b50 "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,309: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/54ee14fb-3cdf-406e-b92c-635256403734 "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,311: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/9ad274ab-d917-4e08-a079-f6545db34b44 "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,312: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/f76f11d5-3085-4cf9-bf96-1dcfa03441ac "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,314: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/848e9bdd-1f2e-43b3-9f20-770a6a05403f "HTTP/1.1 204 No Content"
[2025-07-10 22:47:32,314: ERROR/MainProcess] 修改向量库文档启用状态失败，文档id:49d0d18b-db08-436f-b31f-4371a638d2d7, 错误信息cannot unpack non-iterable UUID object
Traceback (most recent call last):
  File "/Users/icourt1/Desktop/code/llmops/llmops-api/internal/service/indexing_service.py", line 125, in update_document_enabled
    enabled_segment_ids = [id for id, _, enabled in segment_ids if enabled is True]
  File "/Users/icourt1/Desktop/code/llmops/llmops-api/internal/service/indexing_service.py", line 125, in <listcomp>
    enabled_segment_ids = [id for id, _, enabled in segment_ids if enabled is True]
TypeError: cannot unpack non-iterable UUID object
[2025-07-10 22:47:32,315: INFO/MainProcess] UPDATE document SET enabled=%(enabled)s, disabled_at=%(disabled_at)s WHERE document.id = %(document_id)s::UUID
[2025-07-10 22:47:32,315: INFO/MainProcess] [cached since 114s ago] {'enabled': False, 'disabled_at': datetime.datetime(2025, 7, 10, 22, 47, 32, 314771), 'document_id': UUID('49d0d18b-db08-436f-b31f-4371a638d2d7')}
[2025-07-10 22:47:32,316: INFO/MainProcess] COMMIT
[2025-07-10 22:47:32,317: WARNING/MainProcess] /Users/icourt1/Desktop/code/llmops/llmops-api/internal/extension/celery_extension.py:20: ResourceWarning: unclosed <socket.socket fd=22, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('::1', 57168, 0, 0), raddr=('::1', 8080, 0, 0)>
  return self.run(*args, **kwargs)

[2025-07-10 22:47:32,319: INFO/MainProcess] Task internal.task.document_task.update_document_enabled[9543e763-20e4-4140-8882-f27d8df3f59a] succeeded in 0.0732723339997392s: None
[2025-07-10 22:53:08,247: INFO/MainProcess] Connected to redis://localhost:6379/1
[2025-07-10 22:53:08,249: INFO/MainProcess] mingle: searching for neighbors
[2025-07-10 22:53:09,263: INFO/MainProcess] mingle: all alone
[2025-07-10 22:53:09,280: INFO/MainProcess] celery@icourtdeMacBook-Pro.local ready.
[2025-07-10 22:53:20,535: INFO/MainProcess] Task internal.task.document_task.update_document_enabled[57427e57-120e-429d-a488-f886a93bf2f8] received
[2025-07-10 22:53:21,404: WARNING/MainProcess] /Users/icourt1/.pyenv/versions/3.10.16/envs/llmops-env/lib/python3.10/site-packages/jieba/analyse/tfidf.py:47: ResourceWarning: unclosed file <_io.BufferedReader name='/Users/icourt1/.pyenv/versions/3.10.16/envs/llmops-env/lib/python3.10/site-packages/jieba/analyse/idf.txt'>
  content = open(new_idf_path, 'rb').read().decode('utf-8')

[2025-07-10 22:53:21,683: INFO/MainProcess] HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
[2025-07-10 22:53:21,694: INFO/MainProcess] HTTP Request: GET http://localhost:8080/v1/schema/Dataset "HTTP/1.1 200 OK"
[2025-07-10 22:53:21,696: INFO/MainProcess] HTTP Request: GET http://localhost:8080/v1/schema/Dataset "HTTP/1.1 200 OK"
[2025-07-10 22:53:21,702: WARNING/MainProcess] /Users/icourt1/Desktop/code/llmops/llmops-api/internal/service/base_service.py:42: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
  return self.db.session.query(model).get(primary_key)

[2025-07-10 22:53:21,721: INFO/MainProcess] select pg_catalog.version()
[2025-07-10 22:53:21,721: INFO/MainProcess] [raw sql] {}
[2025-07-10 22:53:21,722: INFO/MainProcess] select current_schema()
[2025-07-10 22:53:21,722: INFO/MainProcess] [raw sql] {}
[2025-07-10 22:53:21,723: INFO/MainProcess] show standard_conforming_strings
[2025-07-10 22:53:21,723: INFO/MainProcess] [raw sql] {}
[2025-07-10 22:53:21,723: INFO/MainProcess] BEGIN (implicit)
[2025-07-10 22:53:21,725: INFO/MainProcess] SELECT document.id AS document_id, document.account_id AS document_account_id, document.dataset_id AS document_dataset_id, document.upload_file_id AS document_upload_file_id, document.process_rule_id AS document_process_rule_id, document.batch AS document_batch, document.name AS document_name, document.position AS document_position, document.character_count AS document_character_count, document.token_count AS document_token_count, document.processing_started_at AS document_processing_started_at, document.parsing_completed_at AS document_parsing_completed_at, document.splitting_completed_at AS document_splitting_completed_at, document.indexing_completed_at AS document_indexing_completed_at, document.completed_at AS document_completed_at, document.stopped_at AS document_stopped_at, document.error AS document_error, document.enabled AS document_enabled, document.disabled_at AS document_disabled_at, document.status AS document_status, document.updated_at AS document_updated_at, document.created_at AS document_created_at 
FROM document 
WHERE document.id = %(pk_1)s::UUID
[2025-07-10 22:53:21,726: INFO/MainProcess] [generated in 0.00020s] {'pk_1': UUID('49d0d18b-db08-436f-b31f-4371a638d2d7')}
[2025-07-10 22:53:21,730: INFO/MainProcess] SELECT segment.id AS segment_id, segment.node_id AS segment_node_id, segment.enabled AS segment_enabled 
FROM segment 
WHERE segment.document_id = %(document_id_1)s::UUID AND segment.status = %(status_1)s
[2025-07-10 22:53:21,730: INFO/MainProcess] [generated in 0.00017s] {'document_id_1': UUID('49d0d18b-db08-436f-b31f-4371a638d2d7'), 'status_1': <SegmentStatus.COMPLETED: 'completed'>}
[2025-07-10 22:53:21,738: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/7b30a8c4-adf1-4325-a7c8-0fefe89fe60a "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,740: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/9a1646d4-478e-41e7-b93e-95b8963989dd "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,741: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/7cf8ed58-36df-4932-a4c6-2e968076c160 "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,742: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/a7404b87-eb57-496f-a6a4-a76834487421 "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,744: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/ba5a56a2-cb6b-477e-9203-251779416f05 "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,745: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/d0c0db2a-c0c7-4fe7-b8f1-2a650314fd7a "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,747: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/2f33f2b9-4f95-4508-8e7d-09e7646bdf84 "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,748: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/ce8ddf79-2c11-4180-83c7-ab39014d176f "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,749: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/43bc318c-1dd5-45c9-88a9-373f37f39b50 "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,750: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/54ee14fb-3cdf-406e-b92c-635256403734 "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,752: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/9ad274ab-d917-4e08-a079-f6545db34b44 "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,753: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/f76f11d5-3085-4cf9-bf96-1dcfa03441ac "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,754: INFO/MainProcess] HTTP Request: PATCH http://localhost:8080/v1/objects/Dataset/848e9bdd-1f2e-43b3-9f20-770a6a05403f "HTTP/1.1 204 No Content"
[2025-07-10 22:53:21,757: INFO/MainProcess] SELECT keyword_table.id AS keyword_table_id, keyword_table.dataset_id AS keyword_table_dataset_id, keyword_table.keyword_table AS keyword_table_keyword_table, keyword_table.updated_at AS keyword_table_updated_at, keyword_table.created_at AS keyword_table_created_at 
FROM keyword_table 
WHERE keyword_table.dataset_id = %(dataset_id_1)s::UUID
[2025-07-10 22:53:21,757: INFO/MainProcess] [generated in 0.00018s] {'dataset_id_1': UUID('6c5e3fd6-6307-4eb5-b017-895b25ce4a1c')}
[2025-07-10 22:53:21,761: INFO/MainProcess] SELECT segment.id AS segment_id, segment.keywords AS segment_keywords 
FROM segment 
WHERE segment.id IN (%(id_1_1)s::UUID, %(id_1_2)s::UUID, %(id_1_3)s::UUID, %(id_1_4)s::UUID, %(id_1_5)s::UUID, %(id_1_6)s::UUID, %(id_1_7)s::UUID, %(id_1_8)s::UUID, %(id_1_9)s::UUID, %(id_1_10)s::UUID, %(id_1_11)s::UUID, %(id_1_12)s::UUID, %(id_1_13)s::UUID)
[2025-07-10 22:53:21,761: INFO/MainProcess] [generated in 0.00022s] {'id_1_1': UUID('f741e1d2-7a34-47f2-935b-d84f12b12ecd'), 'id_1_2': UUID('ce46c3b7-d282-4123-936b-41ce7d156454'), 'id_1_3': UUID('7d8424d1-b7de-4bf3-95d7-1e1df1cef419'), 'id_1_4': UUID('bf76c60e-a3ed-4c87-8a53-c1b3531103d0'), 'id_1_5': UUID('a3e87962-371f-41b4-bcd8-524f3ab33bd9'), 'id_1_6': UUID('e63cad59-e4f6-478e-98db-b1742f6827be'), 'id_1_7': UUID('cd1f1e95-8773-4e8a-946e-37586c140214'), 'id_1_8': UUID('80b01423-0cfc-4de4-b97a-74df4fa70a79'), 'id_1_9': UUID('95713bb3-60d0-4ed3-929f-9a230aee688c'), 'id_1_10': UUID('d55a1349-0faf-4238-9b5f-93dcaa49cb72'), 'id_1_11': UUID('d1226985-53e1-40da-8101-2177e255591d'), 'id_1_12': UUID('724e21fd-a942-4d6d-9460-ec97a8282db9'), 'id_1_13': UUID('2cda6fe7-9295-433e-9ecd-9bc017c07e3b')}
[2025-07-10 22:53:21,764: INFO/MainProcess] UPDATE keyword_table SET keyword_table=%(keyword_table)s::JSONB WHERE keyword_table.id = %(keyword_table_id)s::UUID
[2025-07-10 22:53:21,764: INFO/MainProcess] [generated in 0.00028s] {'keyword_table': '{"XX": ["cd1f1e95-8773-4e8a-946e-37586c140214", "76af4d2d-7df3-4cfb-9021-9b4489fa5615", "2660a8c8-c0f2-45d7-93c2-b9767291e307", "497e0f2d-3b9b-4c85-8 ... (21502 characters truncated) ... 55a-4566-a2bf-5d74036c650d", "3490d612-6fc5-49fa-addb-792196cc1c82", "1994e4e2-0be8-4c83-a14a-6effe48bd54c", "cf6f47d9-2c09-4115-9df9-625f51543688"]}', 'keyword_table_id': UUID('3b6aa958-2cff-40e0-9512-9c469e17cd5b')}
[2025-07-10 22:53:21,775: INFO/MainProcess] COMMIT
[2025-07-10 22:53:21,778: WARNING/MainProcess] /Users/icourt1/.pyenv/versions/3.10.16/envs/llmops-env/lib/python3.10/site-packages/weaviate/warnings.py:232: ResourceWarning: Con004: The connection to Weaviate was not closed properly. This can lead to memory leaks.
            Please make sure to close the connection using `client.close()`.
  warnings.warn(

[2025-07-10 22:53:21,779: WARNING/MainProcess] /Users/icourt1/Desktop/code/llmops/llmops-api/internal/extension/celery_extension.py:20: ResourceWarning: unclosed <socket.socket fd=18, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('::1', 58928, 0, 0), raddr=('::1', 8080, 0, 0)>
  return self.run(*args, **kwargs)

[2025-07-10 22:53:21,781: INFO/MainProcess] Task internal.task.document_task.update_document_enabled[57427e57-120e-429d-a488-f886a93bf2f8] succeeded in 1.2456227500006207s: None
